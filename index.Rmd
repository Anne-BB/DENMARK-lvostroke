---
title: "DenmarkSF"
author: "gntem2"
date: "02/03/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r europe}
library(dplyr)
library(tidyverse)
library(sf)
library(eurostat)
library(leaflet)
library(mapview)
#download geospatial data for NUTS-3 regions
#euro_nuts3_sf <-
# eurostat::get_eurostat_geospatial(output_class = #'sf', resolution = '60', nuts_level = 3) %>%
# sf::st_transform(crs = 3035)
#save(euro_nuts3_sf,file="euro_nuts3_sf.Rda")

load("euro_nuts3_sf.Rda")

#Demark = DK
#^ denotes start with
#$denotes end with
DKnuts3_sf<- euro_nuts3_sf%>% filter(str_detect(NUTS_ID,"^DK"))


##https://ec.europa.eu/eurostat/web/nuts/background
##NUTS 1: major socio-economic regions
##NUTS 2: basic regions for the application of regional policies
##NUTS 3: small regions for specific diagnoses

#geocode using tmaptools free
#does not need to get key
#AMH<--geocode_OSM("amager hospital, amager, denmark", as.sf=TRUE)
#12.6  55.7

#AUH <-geocode_OSM("aarhus university hospital, aarhus, denmark", as.sf=TRUE)

#AUH2<-geocode_OSM("aalborg university hospital, aalborg, denmark", as.sf=TRUE)

#BH<-geocode_OSM("bispebjerg hospital, copenhagen, denmark", as.sf=TRUE)

#FH<-geocode_OSM("frederiksberg hospital, frederiksberg, denmark", as.sf=TRUE)

#GH<-geocode_OSM("gentofte hospital, gentofte, denmark", as.sf=TRUE)

#GH2<-geocode_OSM("glostrup hospital, glostrup, denmark", as.sf=TRUE)

  
#HH<-geocode_OSM("herlev hospital, herlev, denmark", as.sf=TRUE)

#HH2<-geocode_OSM("hvidovre hospital, hvidovre, denmark", as.sf=TRUE)

#RCH<-geocode_OSM("rigshospitalet hospital, copenhagen, denmark", as.sf=TRUE)

#1 aarhus university hospital, aarhus, denmark 56.16721 10.20261
#lat_min  lat_max  lon_min  lon_max                  geometry
#1 56.16122 56.17396 10.18073 10.21308 POINT (10.20261 56.16721

#df<-data.frame(Hosp=c("Amager","Aarhus University","Aalborg University","Bispebjerg","Frederiksberg","Gentofte","Glostrup","Herlev","Hvidovre","Rigshospitalet"),
               #Latitude=c(55.7,AUH$lat,AUH2$lat,BH$lat,FH$lat, GH$lat,GH2$lat,HH$lat,HH2$lat,RCH$lat),
               #Lon=c(12.6,AUH$lon,AUH2$lon,BH$lon,FH$lon,GH$lon, GH2$lon,HH$lon,HH2$lon,RCH$lon))

#load data
load("DenmarkHosp.Rda")

#convert df into sf object
df_sf<-st_as_sf(df, 
        coords = c("Lon","Latitude"),
        crs=4326)

```

## different types of plotting methods
```{r plots}

#######################
#plot using simple features by region names
plot(DKnuts3_sf["NUTS_NAME"])


#######################
#ggplot with simple features
#colour by NUTS
ggplot(data=DKnuts3_sf,aes(fill=NUTS_NAME))+geom_sf()

g<-ggplot() + # set up the framework
  geom_sf(data=DKnuts3_sf,aes(fill=NUTS_NAME))+
  #geom_point(data=df_sf,aes(x=Lon, y=Latitude), fill="orange", pch=21, alpha=0.7, size=2)+
  labs(x="Longitude (WGS84)", y="Latitude", title="Map of Points") + 
  theme_bw() # change this to sans if it doesn't plot
g



#######################
#plot with mapview for html, using leaflet
m<-mapview(DKnuts3_sf["NUTS_NAME"]) +

#plot hospital with mapview
mapview(df_sf)
m
######################
#make pics using mapshot
mapshot(m, url = paste0(getwd(),file="/denmark_hosp.html"), file = paste0(getwd(), "/denmark_hosp.png"))


```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
